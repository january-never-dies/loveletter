<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Prologue</title>

  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #fff;
      -webkit-font-smoothing: antialiased;
      width: 100%;
      height: 100%;
      user-select: none;
    }

    #loading-overlay {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 14px;
      transition: opacity 300ms ease;
    }

    #loading-overlay.hide {
      opacity: 0;
      pointer-events: none;
    }

    #container {
      position: relative;
      width: 100%;
      height: 100%;
      background: #fff;
      overflow: hidden;
    }

    .scene {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: opacity 800ms ease;
      display: none;
    }

    .scene.active {
      display: block;
      opacity: 1;
    }

    .layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: auto;
      opacity: 0;
      transform: translate3d(0, 20px, 0);
      transition: opacity 1000ms ease, transform 1000ms ease;
      pointer-events: none;
    }

    .layer.show {
      opacity: 1;
      transform: translate3d(0, 0, 0);
    }

    #next-hint {
      position: absolute;
      bottom: 40px;
      left: 0;
      width: 100%;
      text-align: center;
      font-family: system-ui, sans-serif;
      color: #aaa;
      font-size: 12px;
      opacity: 0;
      transition: opacity 500ms ease;
      pointer-events: none;
    }

    #next-hint.show {
      opacity: 1;
    }

    #goBtn {
      pointer-events: auto;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div id="loading-overlay">Loading…</div>

  <div id="container">
    <!-- Scene A -->
    <div id="scene-a" class="scene active">
      <img class="layer" data-src="assets/a1.webp">
      <img class="layer" data-src="assets/a2.webp">
      <img class="layer" data-src="assets/a3.webp">
      <img class="layer" data-src="assets/a4.webp">
      <img class="layer" data-src="assets/a5.webp">
      <img class="layer" data-src="assets/a6.webp">
      <img class="layer" data-src="assets/a7.webp">
      <img class="layer" data-src="assets/a8.webp">
      <img class="layer" data-src="assets/a9.webp">
      <img class="layer" data-src="assets/a10.webp">
      <img class="layer" data-src="assets/a11.webp">
      <img class="layer" data-src="assets/a12.webp">
      <img class="layer" data-src="assets/a13.webp">
      <div id="next-hint">탭해서 다음으로</div>
    </div>

    <!-- Scene B -->
    <div id="scene-b" class="scene">
      <img class="layer" data-src="assets/b1.webp">
      <img class="layer" data-src="assets/b2.webp">
      <img class="layer" data-src="assets/b3.webp">
      <img class="layer" data-src="assets/b4.webp">
      <img class="layer" data-src="assets/b5.webp">
      <img class="layer" data-src="assets/b6.webp">
      <img class="layer" data-src="assets/b7.webp">
      <img class="layer" data-src="assets/b8.webp">
      <img class="layer" data-src="assets/b9.webp">
      <img class="layer" data-src="assets/b10.webp">
      <img class="layer" data-src="assets/b11.webp">
      <img class="layer" data-src="assets/b12.webp">
      <img class="layer" data-src="assets/b13.webp">
      <img class="layer" data-src="assets/b14.webp">
      <img id="goBtn" class="layer" data-src="assets/button_go.webp">
    </div>
  </div>

  <script>
    const INTERVAL = 600; // 이미지 간격 (ms)
    let currentScene = 'a';
    let isTransitioning = false;
    let sceneAComplete = false;

    const sceneA = document.getElementById('scene-a');
    const sceneB = document.getElementById('scene-b');
    const layersA = [...sceneA.querySelectorAll('.layer')];
    const layersB = [...sceneB.querySelectorAll('.layer')];
    const hint = document.getElementById('next-hint');
    const loading = document.getElementById('loading-overlay');

    async function preloadImages(imgs) {
      const promises = imgs.map(img => {
        return new Promise(resolve => {
          img.onload = resolve;
          img.onerror = resolve;
          img.src = img.dataset.src;
        });
      });
      await Promise.all(promises);
    }

    function showSequential(layers, callback) {
      let i = 0;
      function showNext() {
        if (i < layers.length) {
          layers[i].classList.add('show');
          i++;
          setTimeout(showNext, INTERVAL);
        } else if (callback) {
          callback();
        }
      }
      showNext();
    }

    function goToSceneB() {
      if (isTransitioning || currentScene === 'b') return;
      isTransitioning = true;

      sceneA.style.opacity = '0';
      setTimeout(() => {
        sceneA.classList.remove('active');
        sceneB.classList.add('active');
        currentScene = 'b';
        showSequential(layersB);
        isTransitioning = false;
      }, 800);
    }

    document.body.addEventListener('click', () => {
      if (currentScene === 'a' && sceneAComplete) {
        goToSceneB();
      }
    });

    document.getElementById('goBtn').onclick = (e) => {
      e.stopPropagation();
      location.href = 'sticker.html';
    };

    window.addEventListener('load', async () => {
      // 모든 이미지 미리 로드 (메모리 이슈 방지를 위해 순차 혹은 한꺼번에 로드)
      await preloadImages([...layersA, ...layersB]);

      setTimeout(() => {
        loading.classList.add('hide');
        showSequential(layersA, () => {
          sceneAComplete = true;
          hint.classList.add('show');
        });
      }, 500);
    });
  </script>

</body>

</html>