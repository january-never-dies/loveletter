<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Sticker Board</title>
  <style>
    html,
    body {
      margin: 0;
      height: 100%;
      background: #000;
    }

    * {
      box-sizing: border-box;
    }

    .frame {
      width: min(100vw, calc(100vh * (390/844)));
      aspect-ratio: 390/844;
      margin: auto;
      position: relative;
      overflow: hidden;
      background: #111;
    }

    .bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      user-select: none;
      pointer-events: none;
    }

    .sticker {
      position: absolute;
      transform-origin: center center;
      user-select: none;
      -webkit-user-drag: none;
      cursor: pointer;
      transition: transform .12s ease, opacity .2s ease;
      will-change: transform;
    }

    .sticker:active {
      transform: scale(0.98) rotate(var(--rot, 0deg));
    }

    /* ===== Modal ===== */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }

    .overlay.open {
      display: flex;
    }

    .modal {
      width: min(560px, 100%);
      max-height: min(80vh, 720px);
      background: #fff;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 20px 80px rgba(0, 0, 0, .35);
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", sans-serif;
    }

    .modalHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(0, 0, 0, .08);
    }

    .modalTitle {
      font-weight: 900;
      font-size: 14px;
      letter-spacing: .2px;
    }

    .closeBtn {
      border: 0;
      background: #000;
      color: #fff;
      border-radius: 12px;
      padding: 8px 10px;
      font-weight: 800;
      cursor: pointer;
    }

    .modalBody {
      padding: 14px;
      overflow: auto;
      max-height: calc(min(80vh, 720px) - 54px);
    }

    /* ì½˜í…ì¸  ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .modalBody img {
      width: 100%;
      height: auto;
      border-radius: 14px;
      display: block;
    }

    .modalBody video {
      width: 100%;
      border-radius: 14px;
      display: block;
      background: #000;
    }

    .caption {
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.5;
      opacity: .85;
      white-space: pre-wrap;
    }

    /* YouTube Responsive wrapper */
    .video-container {
      position: relative;
      padding-bottom: 56.25%;
      /* 16:9 */
      height: 0;
      overflow: hidden;
      border-radius: 14px;
      background: #000;
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    .tab-button {
      position: absolute;
      bottom: 10px;
      /* 780px ê¸°ì¤€ 20px -> 390px ê¸°ì¤€ 10px */
      left: 50%;
      transform: translateX(-50%);
      width: 74.87%;
      /* (780-196)/780 â‰ˆ 74.87% */
      cursor: pointer;
      display: none;
      z-index: 100;
      transition: opacity 0.3s ease;
    }

    .tab-button.show {
      display: block;
      opacity: 1;
    }
  </style>
</head>

<body>

  <div class="frame" id="frame">
    <img class="bg" src="assets/st_bg.png" alt="" fetchpriority="high" decoding="async">

    <!-- ë°°ì¹˜ê°’: st_layout ê¸°ì¤€ -->
    <img class="sticker" data-id="A" src="assets/st_A.png"
      style="left:2.05%; top:19.55%; width:73.08%; --rot:0deg; transform:rotate(0deg);" alt="" decoding="async">
    <img class="sticker" data-id="B" src="assets/st_B.png"
      style="left:22.31%; top:29.74%; width:70.77%; --rot:-24.5deg; transform:rotate(-24.5deg);" alt=""
      decoding="async">
    <img class="sticker" data-id="C" src="assets/st_C.png"
      style="left:3.08%; top:49.05%; width:63.85%; --rot:18.8deg; transform:rotate(18.8deg);" alt="" decoding="async">
    <img class="sticker" data-id="D" src="assets/st_D.png"
      style="left:3.33%; top:73.34%; width:81.79%; --rot:-4.8deg; transform:rotate(-4.8deg);" alt="" decoding="async">

    <!-- Tab Button (initially hidden) -->
    <img id="tabButton" class="tab-button" src="assets/tab_button.png" alt="Next Page">
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHeader">
        <div class="modalTitle" id="modalTitle">Sticker</div>
        <button class="closeBtn" id="closeBtn">Close</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <script>
    (() => {
      const overlay = document.getElementById('overlay');
      const closeBtn = document.getElementById('closeBtn');
      const modalTitle = document.getElementById('modalTitle');
      const modalBody = document.getElementById('modalBody');

      // âœ… ì—¬ê¸°ë§Œ ë°”ê¾¸ë©´ ë¨: ìŠ¤í‹°ì»¤ë³„ë¡œ ë³´ì—¬ì¤„ ì½˜í…ì¸  ì •ì˜
      // - image: ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ
      // - video: ì˜ìƒ íŒŒì¼ ê²½ë¡œ(mp4 ê¶Œì¥)
      // - html: ììœ ë¡­ê²Œ í…ìŠ¤íŠ¸/ë§í¬ ë“± ë„£ê¸° (ì§§ê²Œ)
      const CONTENT = {
        A: {
          title: "A â€” Strawberry Cake",
          image: "assets/content_A.jpg",
          caption: "ì—¬ê¸°ì— A ì„¤ëª…/ë¬¸ì¥ ë„£ê¸°"
        },
        B: {
          title: "B â€” R&B",
          youtube: "s8fcHQ-SUrE",
          caption: "ì—¬ê¸°ì— B ì„¤ëª…/ë¬¸ì¥ ë„£ê¸°\n\n(ì˜ìƒ ì¬ìƒì´ ì•ˆ ë  ê²½ìš° ì•„ë˜ ë§í¬ë¥¼ í´ë¦­í•´ì£¼ì„¸ìš”!)"
        },
        C: {
          title: "C â€” Caution",
          image: "assets/content_C.jpg",
          caption: "ì—¬ê¸°ì— C ì„¤ëª…/ë¬¸ì¥ ë„£ê¸°"
        },
        D: {
          title: "D â€” Scent Obsessed",
          image: "assets/content_D.jpg",
          caption: "ì—¬ê¸°ì— D ì„¤ëª…/ë¬¸ì¥ ë„£ê¸°"
        },
      };

      // (ì˜µì…˜) ë³´ê³  ë‚˜ì˜¨ ìŠ¤í‹°ì»¤ë¥¼ ìˆ¨ê¸°ê³  ì‹¶ìœ¼ë©´ true
      const HIDE_AFTER_OPEN = true;
      const VISIT_KEY = "visited_stickers_v1";
      const readVisits = () => { try { return JSON.parse(localStorage.getItem(VISIT_KEY) || "{}"); } catch { return {}; } };
      const writeVisits = (v) => localStorage.setItem(VISIT_KEY, JSON.stringify(v));
      const resetVisits = () => { writeVisits({}); location.reload(); };

      // Debug Reset: ë°°ê²½(frame) 5ë²ˆ í´ë¦­ ì‹œ ì´ˆê¸°í™”
      let bgClickCount = 0;
      document.getElementById('frame').addEventListener('click', (e) => {
        if (e.target.id === 'frame') {
          bgClickCount++;
          if (bgClickCount >= 5) resetVisits();
          setTimeout(() => bgClickCount = 0, 2000);
        }
      });

      const stickers = [...document.querySelectorAll('.sticker')];

      function applyVisited() {
        if (!HIDE_AFTER_OPEN) return;
        const visited = readVisits();
        stickers.forEach(el => {
          if (visited[el.dataset.id]) {
            el.style.opacity = "0";
            el.style.pointerEvents = "none";
          }
        });
        checkAllVisited();
      }

      function checkAllVisited() {
        const visited = readVisits();
        const allIds = stickers.map(el => el.dataset.id);
        const allVisited = allIds.every(id => visited[id]);

        if (allVisited) {
          const tabBtn = document.getElementById('tabButton');
          if (tabBtn) tabBtn.classList.add('show');
        }
      }

      function openModal(id) {
        const data = CONTENT[id];
        if (!data) {
          modalTitle.textContent = id;
          modalBody.innerHTML = `<div class="caption">ì½˜í…ì¸ ê°€ ì•„ì§ ì—†ìŒ</div>`;
        } else {
          modalTitle.textContent = data.title || id;

          // ì½˜í…ì¸  ë Œë”
          let html = "";
          if (data.image) {
            html += `<img src="${data.image}" alt="">`;
          }
          if (data.video) {
            html += `<video src="${data.video}" controls playsinline></video>`;
          }
          if (data.youtube) {
            html += `<div class="video-container">
          <iframe src="https://www.youtube-nocookie.com/embed/${data.youtube}?rel=0" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>`;
            html += `<div style="margin-top:10px; text-align:center;">
          <a href="https://www.youtube.com/watch?v=${data.youtube}" target="_blank" style="color:#007AFF; font-size:13px; text-decoration:none; font-weight:600;">ğŸ“º YouTubeì—ì„œ ì§ì ‘ ë³´ê¸°</a>
        </div>`;
          }
          if (data.html) {
            html += data.html;
          }
          if (data.caption) {
            html += `<div class="caption">${escapeHTML(data.caption)}</div>`;
          }
          modalBody.innerHTML = html;
        }

        overlay.classList.add('open');
        overlay.setAttribute('aria-hidden', 'false');
        overlay.dataset.activeId = id; // í˜„ì¬ ì—´ë¦° ID ì €ì¥
      }

      function closeModal() {
        const id = overlay.dataset.activeId;
        overlay.classList.remove('open');
        overlay.setAttribute('aria-hidden', 'true');
        modalBody.innerHTML = "";

        // ë°©ë¬¸ ì²˜ë¦¬: íŒì—…ì„ 'ë‹«ì„ ë•Œ' ì‚¬ë¼ì§€ë„ë¡ ìˆ˜ì •
        if (HIDE_AFTER_OPEN && id) {
          const v = readVisits();
          v[id] = true;
          writeVisits(v);
          applyVisited();
        }
        overlay.dataset.activeId = "";
      }

      stickers.forEach(el => {
        el.addEventListener('click', () => openModal(el.dataset.id));
      });

      const tabBtn = document.getElementById('tabButton');
      if (tabBtn) {
        tabBtn.addEventListener('click', () => {
          window.location.href = 'letter.html';
        });
      }

      closeBtn.addEventListener('click', closeModal);
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) closeModal(); // ë°”ê¹¥ í´ë¦­ ë‹«ê¸°
      });
      window.addEventListener('keydown', (e) => {
        if (e.key === "Escape" && overlay.classList.contains('open')) closeModal();
      });

      function escapeHTML(s) {
        return String(s)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;");
      }

      applyVisited();
    })();
  </script>

</body>

</html>