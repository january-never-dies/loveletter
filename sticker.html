<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Sticker Board</title>
  <style>
    html,
    body {
      margin: 0;
      min-height: 100vh;
      background: #bcbabc;
      overflow-y: auto;
      overflow-x: hidden;
    }

    * {
      box-sizing: border-box;
    }

    .frame {
      width: min(100vw, calc(100vh * (390/844)));
      aspect-ratio: 390/844;
      margin: auto;
      position: relative;
      overflow: hidden;
      background: #bcbabc;
    }

    .bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      user-select: none;
      pointer-events: none;
    }

    .sticker {
      position: absolute;
      transform-origin: center center;
      user-select: none;
      -webkit-user-drag: none;
      cursor: pointer;
      transition: transform .12s ease, opacity .2s ease;
      will-change: transform;
    }

    .sticker:active {
      transform: scale(0.98) rotate(var(--rot, 0deg));
    }

    /* ===== Modal ===== */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }

    .overlay.open {
      display: flex;
    }

    .modal {
      width: min(560px, 100%);
      max-height: min(80vh, 720px);
      background: #fff;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 20px 80px rgba(0, 0, 0, .35);
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", sans-serif;
    }

    .modalHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(0, 0, 0, .08);
    }

    .modalTitle {
      font-weight: 900;
      font-size: 14px;
      letter-spacing: .2px;
    }

    .closeBtn {
      border: 0;
      background: #000;
      color: #fff;
      border-radius: 12px;
      padding: 8px 10px;
      font-weight: 800;
      cursor: pointer;
    }

    .modalBody {
      padding: 14px;
      overflow: auto;
      max-height: calc(min(80vh, 720px) - 54px);
    }

    /* ÏΩòÌÖêÏ∏† Í∏∞Î≥∏ Ïä§ÌÉÄÏùº */
    .modalBody img {
      width: 100%;
      height: auto;
      border-radius: 14px;
      display: block;
    }

    .modalBody video {
      width: 100%;
      border-radius: 14px;
      display: block;
      background: #000;
    }

    .caption {
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.5;
      opacity: .85;
      white-space: pre-wrap;
    }

    /* YouTube Responsive wrapper */
    .video-container {
      position: relative;
      padding-bottom: 56.25%;
      /* 16:9 */
      height: 0;
      overflow: hidden;
      border-radius: 14px;
      background: #000;
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    .tab-button {
      position: absolute;
      bottom: 10px;
      /* 780px Í∏∞Ï§Ä 20px -> 390px Í∏∞Ï§Ä 10px */
      left: 50%;
      transform: translateX(-50%);
      width: 50%;
      /* (780-196)/780 ‚âà 74.87% -> reduced to 50% */
      cursor: pointer;
      display: none;
      z-index: 100;
      transition: opacity 0.3s ease;
    }

    .tab-button.show {
      display: block;
      opacity: 1;
    }

    /* ===== Slider for A & D ===== */
    .slider-outer {
      position: relative;
      width: 100%;
      aspect-ratio: 1/1;
      /* 1080/1350(0.8) -> 1/1(1) Î°ú Î≥ÄÍ≤ΩÌïòÏó¨ ÌåùÏóÖ ÎÇ¥ Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ */
      overflow: hidden;
      border-radius: 14px;
      background: #fdfdfd;
      touch-action: pan-y;
    }

    .slider-container {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .slide {
      flex: 0 0 100%;
      width: 100%;
      height: 100%;
    }

    .slide img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 0;
      /* Ïä¨ÎùºÏù¥Îçî ÎÇ¥Î∂Ä Ïù¥ÎØ∏ÏßÄÎäî Ïª®ÌÖåÏù¥ÎÑà ÎùºÏö¥Îî© Îî∞Î¶Ñ */
      display: block;
    }

    /* 3D Flip Card Styles */
    .slide-outer {
      width: 100%;
      height: 100%;
      perspective: 1000px;
      cursor: pointer;
    }

    .slide-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }

    .slide-outer.flipped .slide-inner {
      transform: rotateY(180deg);
    }

    .slide-front,
    .slide-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 14px;
      overflow: hidden;
    }

    .slide-front {
      background: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .slide-front img {
      width: auto;
      height: 45%;
      /* Ìñ•ÏàòÎ≥ë ÌÅ¨Í∏∞ Ï∂ïÏÜå */
      object-fit: contain;
      margin-bottom: 20px;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.05));
    }

    .front-brand {
      font-size: 11px;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .front-name {
      font-size: 16px;
      font-weight: 700;
      color: #333;
      text-align: center;
      padding: 0 10px;
    }

    .slide-back {
      transform: rotateY(180deg);
      background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      text-align: center;
      box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.05);
      z-index: 1;
    }

    .perfume-tag {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #999;
      margin-bottom: 8px;
    }

    .perfume-name {
      font-size: 22px;
      font-weight: 800;
      color: #222;
      margin-bottom: 12px;
      line-height: 1.2;
    }

    .perfume-divider {
      width: 30px;
      height: 1px;
      background: #000;
      margin-bottom: 16px;
    }

    .perfume-desc {
      font-size: 14px;
      line-height: 1.6;
      color: #555;
      word-break: keep-all;
    }

    .click-tip {
      position: absolute;
      bottom: 20px;
      font-size: 10px;
      color: #aaa;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 0.4;
      }

      50% {
        opacity: 1;
      }

      100% {
        opacity: 0.4;
      }
    }

    .nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      border: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      font-size: 18px;
    }

    .nav-btn:active {
      background: #fff;
    }

    .prev-btn {
      left: 10px;
    }

    .next-btn {
      right: 10px;
    }

    .dots-container {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 10;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: background 0.3s;
    }

    .dot.active {
      background: #fff;
    }
  </style>
</head>

<body>

  <div class="frame" id="frame">
    <img class="bg" src="assets/st_bg.png" alt="" fetchpriority="high" decoding="async">

    <!-- Î∞∞ÏπòÍ∞í: st_layout Í∏∞Ï§Ä -->
    <img class="sticker" data-id="A" src="assets/st_A.png"
      style="left:2.05%; top:19.55%; width:73.08%; --rot:0deg; transform:rotate(0deg);" alt="" decoding="async">
    <img class="sticker" data-id="B" src="assets/st_B.png"
      style="left:22.31%; top:29.74%; width:70.77%; --rot:-24.5deg; transform:rotate(-24.5deg);" alt=""
      decoding="async">
    <img class="sticker" data-id="C" src="assets/st_C.png"
      style="left:3.08%; top:49.05%; width:63.85%; --rot:18.8deg; transform:rotate(18.8deg);" alt="" decoding="async">
    <img class="sticker" data-id="D" src="assets/st_D.png"
      style="left:3.33%; top:73.34%; width:81.79%; --rot:-4.8deg; transform:rotate(-4.8deg);" alt="" decoding="async">

    <!-- Tab Button (initially hidden) -->
    <img id="tabButton" class="tab-button" src="assets/tab_button.png" alt="Next Page">
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHeader">
        <div class="modalTitle" id="modalTitle">Sticker</div>
        <button class="closeBtn" id="closeBtn">Close</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <script>
    (() => {
      const overlay = document.getElementById('overlay');
      const closeBtn = document.getElementById('closeBtn');
      const modalTitle = document.getElementById('modalTitle');
      const modalBody = document.getElementById('modalBody');

      // ‚úÖ Ïó¨Í∏∞Îßå Î∞îÍæ∏Î©¥ Îê®: Ïä§Ìã∞Ïª§Î≥ÑÎ°ú Î≥¥Ïó¨Ï§Ñ ÏΩòÌÖêÏ∏† Ï†ïÏùò
      // - image: Ïù¥ÎØ∏ÏßÄ ÌååÏùº Í≤ΩÎ°ú
      // - video: ÏòÅÏÉÅ ÌååÏùº Í≤ΩÎ°ú(mp4 Í∂åÏû•)
      // - html: ÏûêÏú†Î°≠Í≤å ÌÖçÏä§Ìä∏/ÎßÅÌÅ¨ Îì± ÎÑ£Í∏∞ (ÏßßÍ≤å)
      const CONTENT = {
        A: {
          title: "My sweetie loves sweet things.",
          images: ["assets/cake_0.png", "assets/cake_1.png", "assets/cake_2.png"],
          caption: "260101Í≥º ÌÇ§Ïπú205."
        },
        B: {
          title: "Ïó¨Ïú†Î°úÏö¥ ÌòÑÏÑúÏùò Ïó¨Ïú†Î°úÏö¥ R&B ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏.",
          youtube: "s8fcHQ-SUrE",
          caption: "Î∂ÄÎìúÎüΩÍ≥† Í∞êÍ∞ÅÏ†ÅÏù∏ Î¨¥ÎìúÎ•º ÏÇ¨ÎûëÌïòÎäî ÎèÑÏòÅÏù¥Î•º ÏúÑÌïú R&B ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ÏûÖÎãàÎã§. ÍπäÏù¥ ÏûàÎäî Î¶¨Îì¨Í≥º Í∞êÎØ∏Î°úÏö¥ ÏÑ†Ïú®Ïóê Î™∏ÏùÑ Îß°Í≤®Î≥¥ÏÑ∏Ïöî.\n\n[Tracklist üíø]\n0:00 Bungee - Î∞±ÌòÑ\n3:21 Make up - Sam Kim\n6:43 Open Arms - SZA\n9:41 trippin‚Äô - thuy\n12:01 Toronto 2014 - Daniel Caesar\n16:35 Come Around Me - Justin Bieber"
        },
        C: {
          title: "Different rings everyday",
          image: "assets/st_A_ring.gif",
          caption: "Ï£ºÏñºÎ¶¨ ÌååÏö∞ÏπòÎ•º Îì§Í≥† Îã§ÎãàÎ©∞ ÎÇ†ÎßàÎã§ Î∞òÏßÄÎ•º Î∞îÍøîÎÇÄÎã§Í≥† ÌïúÎã§."
        },
        D: {
          title: "The Scent of Memories",
          items: [
            { src: "assets/per_maejong.png", name: "Replica Jazz Club", brand: "Maison Margiela", desc: "Í≤®Ïö∏Ïóê ÏûêÏ£º ÏÇ¨Ïö©ÌïòÎäî Ìñ•ÏàòÎ°ú, ÌòÑÏû¨ Í±∞Ïùò ÏÑ∏ ÌÜµÏß∏ ÏÇ¨Ïö© Ï§ëÏù¥Îã§. ÏùòÏô∏Î°ú Ï§ëÏÑ±Ï†ÅÏù∏ Ìñ•ÏúºÎ°ú ÎäêÍª¥ÏßÑÎã§Í≥† ÌïúÎã§." },
            { src: "assets/per_missdior.png", name: "Miss Dior Blooming Bouquet", brand: "Dior", desc: "Îç∞Î∑î Ï¥àÏóê ÎßéÏù¥ ÏÇ¨Ïö©ÌñàÎçò Ìñ•ÏàòÎ°ú Ïñ∏Í∏âÌñàÎã§." },
            { src: "assets/per_lipsaeng.png", name: "Libre", brand: "YSL", desc: "ÌòÑÏÑúÍ∞Ä ÏÑ∏ ÌÜµÏß∏ ÏÇ¨Ïö© Ï§ëÏù∏ Ìñ•ÏàòÏôÄ Ìñ•Ïù¥ ÎπÑÏä∑Ìï¥ ÌïúÎèôÏïà ÏûêÏ£º ÏÇ¨Ïö©ÌñàÎã§Í≥† ÌïúÎã§." },
            { src: "assets/per_ell.png", name: "H24", brand: "Hermes", desc: "ÌòÑÏÑú ÌîºÏÖú Ïñ¥Î•∏Ïä§Îü¨Ïö¥ Ìñ•Ïàò. Ïñ¥Î•∏Ïä§Îü¨Ïö¥(?) Î∂ÑÏúÑÍ∏∞Î•º ÎÇ¥Í≥† Ïã∂ÏùÑ Îïå ÏÇ¨Ïö©ÌïòÎ©∞, Ïù¥Í≤É Ïó≠Ïãú Îëê ÌÜµÏß∏ ÏÇ¨Ïö© Ï§ë." },
            { src: "assets/per_rose.png", name: "Portrait of a Lady", brand: "Frederic Malle", desc: "ÏûëÎÖÑ Ïó¨Î¶Ñ ÎùºÏù¥Î∏å Î∞©ÏÜ°ÏóêÏÑú ÌòÑÏÑúÍ∞Ä ÏßÅÏ†ë ÏÜåÍ∞úÌïú Ìñ•Ïàò. Í≥ÑÏ†àÎßàÎã§ Ìñ•ÏàòÎ•º Î∞îÍøî ÏÇ¨Ïö©ÌïúÎã§Í≥† ÌñàÏùÑ Îïå, Ïù¥ Ìñ•ÏùÄ 2025ÎÖÑ Ïó¨Î¶Ñ Ìñ•ÏàòÎ°ú Ïñ∏Í∏âÎêòÏóàÎã§." },
            { src: "assets/per_gucci.png", name: "Alchemist's Garden A Floral Verse", brand: "Gucci", desc: "Î°§ÎùºÌåîÎ£®Ïûê ÌååÎ¶¨Ïóê Îã§ÎÖÄÏò§Î©∞ Íµ¨Îß§Ìïú Ìñ•ÏàòÎùºÍ≥† ÌïúÎã§." },
            { src: "assets/per_vio.png", name: "Violet Multi Perfume", brand: "Granhand", desc: "ÍΩÉÌñ•Ïù¥ ÎöúÎ†∑Ìïú Ìñ•ÏúºÎ°ú, Ïò∑Ïóê Í∞ÄÎ≥çÍ≤å ÎøåÎ¶¨Î©¥ ÏûîÌñ•Ïù¥ Ï¢ãÏïÑ ÏûêÏ£º ÏÇ¨Ïö©ÌïúÎã§Í≥† ÌïúÎã§." }
          ],
          caption: "Ìñ•ÏàòÎ≥ëÏùÑ ÌÅ¥Î¶≠Ìï¥Î≥¥ÏÑ∏Ïöî!"
        },
      };

      // (ÏòµÏÖò) Î≥¥Í≥† ÎÇòÏò® Ïä§Ìã∞Ïª§Î•º Ïà®Í∏∞Í≥† Ïã∂ÏúºÎ©¥ true
      const HIDE_AFTER_OPEN = true;
      const VISIT_KEY = "visited_stickers_v1";
      const readVisits = () => { try { return JSON.parse(localStorage.getItem(VISIT_KEY) || "{}"); } catch { return {}; } };
      const writeVisits = (v) => localStorage.setItem(VISIT_KEY, JSON.stringify(v));
      const resetVisits = () => { writeVisits({}); location.reload(); };

      // Debug Reset: Î∞∞Í≤Ω(frame) 5Î≤à ÌÅ¥Î¶≠ Ïãú Ï¥àÍ∏∞Ìôî
      let bgClickCount = 0;
      document.getElementById('frame').addEventListener('click', (e) => {
        if (e.target.id === 'frame') {
          bgClickCount++;
          if (bgClickCount >= 5) resetVisits();
          setTimeout(() => bgClickCount = 0, 2000);
        }
      });

      const stickers = [...document.querySelectorAll('.sticker')];

      const sessionVisited = {};

      function applyVisited() {
        // Îçî Ïù¥ÏÉÅ Ï¥àÍ∏∞ Î°úÎìúÏãú Ïä§Ìã∞Ïª§Î•º Ïà®Í∏∞ÏßÄ ÏïäÏäµÎãàÎã§. (ÏÇ¨Ïö©Ïûê ÏöîÏ≤≠: "Ï≤òÏùåÏóêÎäî Îã§ Î≥¥Ïó¨Ïïº Ìï®")
        // ÎòêÌïú Ï¥àÍ∏∞ Î°úÎìúÏãú Î≤ÑÌäºÏùÑ Ï≤¥ÌÅ¨ÌïòÏßÄ ÏïäÏïÑ Îß§ ÏÑ∏ÏÖòÎßàÎã§ ÏÉàÎ°ú ÌÅ¥Î¶≠ÌïòÎèÑÎ°ù Ïú†ÎèÑÌï©ÎãàÎã§.
      }

      function checkAllVisited() {
        const allIds = stickers.map(el => el.dataset.id);
        const allVisited = allIds.every(id => sessionVisited[id]);

        if (allVisited) {
          const tabBtn = document.getElementById('tabButton');
          if (tabBtn) tabBtn.classList.add('show');
        }
      }

      function openModal(id) {
        const data = CONTENT[id];
        if (!data) {
          modalTitle.textContent = id;
          modalBody.innerHTML = `<div class="caption">ÏΩòÌÖêÏ∏†Í∞Ä ÏïÑÏßÅ ÏóÜÏùå</div>`;
        } else {
          modalTitle.textContent = data.title || id;

          // ÏΩòÌÖêÏ∏† Î†åÎçî
          let html = "";
          if (data.items && Array.isArray(data.items)) {
            html += renderSlider(data.items, true);
          } else if (data.images && Array.isArray(data.images)) {
            html += renderSlider(data.images);
          } else if (data.image) {
            html += `<img src="${data.image}" alt="">`;
          }
          if (data.video) {
            html += `<video src="${data.video}" controls playsinline></video>`;
          }
          if (data.youtube) {
            html += `<div class="video-container">
          <iframe src="https://www.youtube-nocookie.com/embed/${data.youtube}?rel=0" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>`;
          }
          if (data.html) {
            html += data.html;
          }
          if (data.caption) {
            html += `<div class="caption">${escapeHTML(data.caption)}</div>`;
          }
          modalBody.innerHTML = html;

          if ((data.images && Array.isArray(data.images)) || (data.items && Array.isArray(data.items))) {
            setupSlider();
          }
        }

        overlay.classList.add('open');
        overlay.setAttribute('aria-hidden', 'false');
        overlay.dataset.activeId = id; // ÌòÑÏû¨ Ïó¥Î¶∞ ID Ï†ÄÏû•
      }

      function closeModal() {
        const id = overlay.dataset.activeId;
        overlay.classList.remove('open');
        overlay.setAttribute('aria-hidden', 'true');
        modalBody.innerHTML = "";

        // Î∞©Î¨∏ Ï≤òÎ¶¨ Î∞è Ïä§Ìã∞Ïª§ Ïà®Í∏∞Í∏∞: ÌåùÏóÖÏùÑ 'Îã´ÏùÑ Îïå' ÏÇ¨ÎùºÏßÄÎèÑÎ°ù ÏàòÏ†ï
        if (HIDE_AFTER_OPEN && id) {
          sessionVisited[id] = true;
          const v = readVisits();
          v[id] = true;
          writeVisits(v);

          // ÌòÑÏû¨ ÏÑ∏ÏÖòÏóêÏÑú Ï¶âÏãú Ïà®ÍπÄ Ï≤òÎ¶¨
          const el = stickers.find(s => s.dataset.id === id);
          if (el) {
            el.style.opacity = "0";
            el.style.pointerEvents = "none";
          }

          checkAllVisited();
        }
        overlay.dataset.activeId = "";
      }

      stickers.forEach(el => {
        el.addEventListener('click', () => openModal(el.dataset.id));
      });

      const tabBtn = document.getElementById('tabButton');
      if (tabBtn) {
        tabBtn.addEventListener('click', () => {
          window.location.href = 'letter.html';
        });
      }

      closeBtn.addEventListener('click', closeModal);
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) closeModal(); // Î∞îÍπ• ÌÅ¥Î¶≠ Îã´Í∏∞
      });
      window.addEventListener('keydown', (e) => {
        if (e.key === "Escape" && overlay.classList.contains('open')) closeModal();
      });

      function renderSlider(data, isInteractive = false) {
        let slides = data.map((item, i) => {
          const src = typeof item === 'string' ? item : item.src;
          if (isInteractive) {
            return `
              <div class="slide">
                <div class="slide-outer" onclick="this.classList.toggle('flipped')">
                  <div class="slide-inner">
                    <div class="slide-front">
                      <img src="${src}" alt="">
                      <div class="front-brand">${item.brand}</div>
                      <div class="front-name">${item.name}</div>
                      <div class="click-tip">Tap to reveal info</div>
                    </div>
                    <div class="slide-back">
                      <div class="perfume-desc">${item.desc}</div>
                    </div>
                  </div>
                </div>
              </div>`;
          }
          return `<div class="slide"><img src="${src}" alt=""></div>`;
        }).join("");

        let dots = data.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}" data-idx="${i}"></div>`).join("");
        return `
          <div class="slider-outer" id="sliderOuter">
            <div class="slider-container" id="sliderContainer">
              ${slides}
            </div>
            <button class="nav-btn prev-btn">‚ùÆ</button>
            <button class="nav-btn next-btn">‚ùØ</button>
            <div class="dots-container">
              ${dots}
            </div>
          </div>
        `;
      }

      function setupSlider() {
        const container = document.getElementById('sliderContainer');
        const outer = document.getElementById('sliderOuter');
        const dots = outer.querySelectorAll('.dot');
        const prevBtn = outer.querySelector('.prev-btn');
        const nextBtn = outer.querySelector('.next-btn');
        let currentIndex = 0;
        const totalSlides = dots.length;

        function updateSlider() {
          container.style.transform = `translateX(-${currentIndex * 100}%)`;
          dots.forEach((dot, i) => dot.classList.toggle('active', i === currentIndex));
        }

        function goNext() {
          currentIndex = (currentIndex + 1) % totalSlides;
          updateSlider();
        }

        function goPrev() {
          currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
          updateSlider();
        }

        nextBtn.addEventListener('click', goNext);
        prevBtn.addEventListener('click', goPrev);

        dots.forEach(dot => {
          dot.addEventListener('click', () => {
            currentIndex = parseInt(dot.dataset.idx);
            updateSlider();
          });
        });

        // Swipe (Mobile)
        let startX = 0;
        outer.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
        }, { passive: true });

        outer.addEventListener('touchend', (e) => {
          let endX = e.changedTouches[0].clientX;
          let diff = startX - endX;
          if (Math.abs(diff) > 50) {
            if (diff > 0) goNext();
            else goPrev();
          }
        }, { passive: true });
      }

      function escapeHTML(s) {
        return String(s)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;");
      }

      applyVisited();
    })();
  </script>

</body>

</html>